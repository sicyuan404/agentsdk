---
title: æ²™ç®±ç³»ç»Ÿ
description: ç†è§£ä»£ç å®‰å…¨æ‰§è¡Œå’Œæ²™ç®±é…ç½®
---

# æ²™ç®±ç³»ç»Ÿ

AgentSDKçš„æ²™ç®±ç³»ç»Ÿæä¾›å®‰å…¨éš”ç¦»çš„ä»£ç æ‰§è¡Œç¯å¢ƒï¼Œç¡®ä¿Agentæ‰§è¡Œçš„å‘½ä»¤ä¸ä¼šå±å®³ä¸»æœºç³»ç»Ÿã€‚

## ğŸ›¡ï¸ ä¸ºä»€ä¹ˆéœ€è¦æ²™ç®±ï¼Ÿ

### å®‰å…¨é£é™©

Agentå¯èƒ½ä¼šï¼š
- æ‰§è¡Œå±é™©å‘½ä»¤ï¼ˆ`rm -rf /`ï¼‰
- è®¿é—®æ•æ„Ÿæ–‡ä»¶
- å‘èµ·ç½‘ç»œæ”»å‡»
- æ¶ˆè€—è¿‡å¤šèµ„æº

### æ²™ç®±çš„ä½œç”¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ä¸»æœºç³»ç»Ÿ                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      AgentSDK Runtime        â”‚  â”‚
â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚     Sandbox            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  Agentæ‰§è¡Œä»£ç     â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  (éš”ç¦»ç¯å¢ƒ)       â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - é™åˆ¶æ–‡ä»¶è®¿é—®        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - é™åˆ¶ç½‘ç»œè®¿é—®        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - é™åˆ¶èµ„æºä½¿ç”¨        â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ æ²™ç®±ç±»å‹

AgentSDKæ”¯æŒå¤šç§æ²™ç®±åç«¯ï¼š

| æ²™ç®±ç±»å‹ | éš”ç¦»çº§åˆ« | ä½¿ç”¨åœºæ™¯ | æ€§èƒ½ | æˆæœ¬ |
|---------|---------|---------|------|------|
| **LocalSandbox** | è¿›ç¨‹çº§ | å¼€å‘æµ‹è¯• | é«˜ | å…è´¹ |
| **AliyunSandbox** | å®¹å™¨çº§ | ç”Ÿäº§ç¯å¢ƒ | ä¸­ | æŒ‰ç”¨é‡ |
| **VolcengineSandbox** | å®¹å™¨çº§ | ç”Ÿäº§ç¯å¢ƒ | é«˜ | æŒ‰ç”¨é‡ |
| **MockSandbox** | æ— éš”ç¦» | å•å…ƒæµ‹è¯• | æé«˜ | å…è´¹ |

## ğŸ  LocalSandbox

### ç‰¹ç‚¹

- åœ¨æœ¬åœ°è¿›ç¨‹æˆ–Dockerå®¹å™¨ä¸­æ‰§è¡Œ
- é€‚åˆå¼€å‘å’Œæµ‹è¯•
- ä½å»¶è¿Ÿã€é«˜æ€§èƒ½
- å…è´¹ä½¿ç”¨

### é…ç½®

```go
ag, err := agent.Create(ctx, &types.AgentConfig{
    Sandbox: &types.SandboxConfig{
        Kind:    types.SandboxKindLocal,
        WorkDir: "./workspace",
    },
}, deps)
```

### Dockeræ¨¡å¼

```go
ag, err := agent.Create(ctx, &types.AgentConfig{
    Sandbox: &types.SandboxConfig{
        Kind:    types.SandboxKindLocal,
        WorkDir: "/workspace",
        Config: map[string]interface{}{
            "use_docker": true,
            "image":      "golang:1.21",
            "memory":     "512m",
            "cpu":        "1.0",
        },
    },
}, deps)
```

### é™åˆ¶

- ä¾èµ–ä¸»æœºç¯å¢ƒ
- éš”ç¦»æ€§è¾ƒå¼±
- ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ
- éœ€è¦æ‰‹åŠ¨ç®¡ç†æ¸…ç†

## â˜ï¸ AliyunSandbox

### ç‰¹ç‚¹

- é˜¿é‡Œäº‘AgentBay Computer Use
- å®¹å™¨çº§éš”ç¦»
- æŒ‰éœ€ä»˜è´¹
- è‡ªåŠ¨æ‰©ç¼©å®¹
- ç”Ÿäº§çº§ç¨³å®šæ€§

### å¼€é€šæœåŠ¡

1. è®¿é—®[é˜¿é‡Œäº‘AgentBay](https://www.aliyun.com/product/agentbay)
2. å¼€é€šæœåŠ¡
3. è·å–AccessKeyå’ŒSecretKey

### é…ç½®

```go
ag, err := agent.Create(ctx, &types.AgentConfig{
    Sandbox: &types.SandboxConfig{
        Kind:    types.SandboxKindAliyun,
        WorkDir: "/workspace",
        Config: map[string]interface{}{
            "region":     "cn-hangzhou",
            "access_key": os.Getenv("ALIYUN_ACCESS_KEY_ID"),
            "secret_key": os.Getenv("ALIYUN_ACCESS_KEY_SECRET"),

            // å¯é€‰é…ç½®
            "timeout":       300,        // è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
            "memory_limit":  1024,       // å†…å­˜é™åˆ¶ï¼ˆMBï¼‰
            "cpu_limit":     2.0,        // CPUé™åˆ¶ï¼ˆæ ¸å¿ƒæ•°ï¼‰
            "network_mode":  "restricted", // ç½‘ç»œæ¨¡å¼
        },
    },
}, deps)
```

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# .envæ–‡ä»¶
export ALIYUN_ACCESS_KEY_ID="your-access-key"
export ALIYUN_ACCESS_KEY_SECRET="your-secret-key"
export ALIYUN_REGION="cn-hangzhou"
```

### è´¹ç”¨è¯´æ˜

- æŒ‰æ‰§è¡Œæ—¶é—´è®¡è´¹
- çº¦ï¿¥0.01/ç§’ï¼ˆå–å†³äºèµ„æºé…ç½®ï¼‰
- æœ‰å…è´¹é¢åº¦ï¼ˆæ–°ç”¨æˆ·ï¼‰

## ğŸŒ‹ VolcengineSandbox

### ç‰¹ç‚¹

- ç«å±±å¼•æ“äº‘æ²™ç®±
- é«˜æ€§èƒ½è®¡ç®—
- å®¹å™¨çº§éš”ç¦»
- æŒ‰éœ€ä»˜è´¹

### å¼€é€šæœåŠ¡

1. è®¿é—®[ç«å±±å¼•æ“](https://www.volcengine.com/)
2. å¼€é€šæ²™ç®±æœåŠ¡
3. è·å–AK/SK

### é…ç½®

```go
ag, err := agent.Create(ctx, &types.AgentConfig{
    Sandbox: &types.SandboxConfig{
        Kind:    types.SandboxKindVolcengine,
        WorkDir: "/workspace",
        Config: map[string]interface{}{
            "region":           "cn-beijing",
            "access_key_id":    os.Getenv("VOLC_ACCESS_KEY_ID"),
            "secret_access_key": os.Getenv("VOLC_SECRET_ACCESS_KEY"),

            // å¯é€‰é…ç½®
            "instance_type": "standard",  // standard/performance
            "timeout":       600,
            "auto_destroy":  true,
        },
    },
}, deps)
```

## ğŸ§ª MockSandbox

### ç‰¹ç‚¹

- æ¨¡æ‹Ÿæ‰§è¡Œï¼Œä¸å®é™…è¿è¡Œ
- ç”¨äºå•å…ƒæµ‹è¯•
- æ— å‰¯ä½œç”¨
- å¯é¢„è®¾è¿”å›å€¼

### é…ç½®

```go
mockSandbox := sandbox.NewMockSandbox()

// é¢„è®¾å‘½ä»¤è¿”å›
mockSandbox.SetOutput("ls", "file1.txt\nfile2.txt\n")
mockSandbox.SetOutput("cat README.md", "# Hello\n...")

ag, err := agent.Create(ctx, &types.AgentConfig{
    Sandbox: &types.SandboxConfig{
        Kind: types.SandboxKindMock,
    },
}, &agent.Dependencies{
    SandboxFactory: func() sandbox.Sandbox {
        return mockSandbox
    },
    // ...
})
```

### æµ‹è¯•ç¤ºä¾‹

```go
func TestAgentWithMockSandbox(t *testing.T) {
    mock := sandbox.NewMockSandbox()
    mock.SetOutput("go test", "PASS\nok\t...")

    ag, _ := agent.Create(ctx, config, &agent.Dependencies{
        SandboxFactory: func() sandbox.Sandbox {
            return mock
        },
    })

    result, _ := ag.Chat(ctx, "è¿è¡Œæµ‹è¯•")
    assert.Contains(t, result.Text, "æµ‹è¯•é€šè¿‡")
}
```

## ğŸ”§ Sandboxæ¥å£

### æ¥å£å®šä¹‰

```go
type Sandbox interface {
    // æ‰§è¡Œå‘½ä»¤
    Execute(ctx context.Context, cmd *Command) (*Result, error)

    // æ–‡ä»¶æ“ä½œ
    ReadFile(ctx context.Context, path string) ([]byte, error)
    WriteFile(ctx context.Context, path string, content []byte) error
    ListFiles(ctx context.Context, path string) ([]FileInfo, error)

    // ç”Ÿå‘½å‘¨æœŸ
    Start(ctx context.Context) error
    Stop(ctx context.Context) error
    Health(ctx context.Context) error
}
```

### Commandç»“æ„

```go
type Command struct {
    Command     string            // å‘½ä»¤å­—ç¬¦ä¸²
    Args        []string          // å‚æ•°
    Env         map[string]string // ç¯å¢ƒå˜é‡
    WorkDir     string            // å·¥ä½œç›®å½•
    Timeout     time.Duration     // è¶…æ—¶æ—¶é—´
    StdinData   []byte            // æ ‡å‡†è¾“å…¥
}
```

### Resultç»“æ„

```go
type Result struct {
    Stdout   string // æ ‡å‡†è¾“å‡º
    Stderr   string // æ ‡å‡†é”™è¯¯
    ExitCode int    // é€€å‡ºç 
    Duration time.Duration // æ‰§è¡Œæ—¶é•¿
    Error    error  // é”™è¯¯ï¼ˆå¦‚æœ‰ï¼‰
}
```

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šä»£ç æ‰§è¡Œ

```go
// Agentæ‰§è¡Œbashå‘½ä»¤
ag.Chat(ctx, `
è¿è¡Œä»¥ä¸‹Goç¨‹åºï¼š
go run main.go

ç„¶åå‘Šè¯‰æˆ‘è¾“å‡ºæ˜¯ä»€ä¹ˆ
`)
```

æ²™ç®±ä¸­æ‰§è¡Œï¼š
```bash
$ go run main.go
Hello, World!
```

### åœºæ™¯2ï¼šæ–‡ä»¶æ“ä½œ

```go
// Agentæ“ä½œæ–‡ä»¶
ag.Chat(ctx, `
1. åˆ›å»ºä¸€ä¸ªhello.txtæ–‡ä»¶
2. å†™å…¥"Hello AgentSDK"
3. è¯»å–å¹¶éªŒè¯å†…å®¹
`)
```

æ²™ç®±æ“ä½œï¼š
```bash
$ echo "Hello AgentSDK" > /workspace/hello.txt
$ cat /workspace/hello.txt
Hello AgentSDK
```

### åœºæ™¯3ï¼šä¾èµ–å®‰è£…

```go
// Agentå®‰è£…ä¾èµ–
ag.Chat(ctx, `
å®‰è£…æ‰€éœ€çš„PythonåŒ…ï¼š
pip install requests beautifulsoup4

ç„¶åè¿è¡Œscraper.py
`)
```

### åœºæ™¯4ï¼šæµ‹è¯•è¿è¡Œ

```go
// Agentè¿è¡Œæµ‹è¯•
ag.Chat(ctx, `
è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•ï¼š
go test ./...

å¦‚æœæœ‰å¤±è´¥ï¼Œåˆ†æåŸå› 
`)
```

## âš™ï¸ é«˜çº§é…ç½®

### èµ„æºé™åˆ¶

```go
Sandbox: &types.SandboxConfig{
    Kind: types.SandboxKindAliyun,
    Config: map[string]interface{}{
        // CPUé™åˆ¶
        "cpu_limit": 2.0,  // 2ä¸ªCPUæ ¸å¿ƒ
        "cpu_request": 1.0, // è¯·æ±‚1ä¸ªæ ¸å¿ƒ

        // å†…å­˜é™åˆ¶
        "memory_limit": 2048,  // 2GB
        "memory_request": 1024, // è¯·æ±‚1GB

        // ç£ç›˜é™åˆ¶
        "disk_limit": 10240,  // 10GB

        // è¶…æ—¶é™åˆ¶
        "timeout": 600,  // 10åˆ†é’Ÿ
        "idle_timeout": 300,  // ç©ºé—²5åˆ†é’Ÿè‡ªåŠ¨é”€æ¯
    },
}
```

### ç½‘ç»œé…ç½®

```go
Config: map[string]interface{}{
    // ç½‘ç»œæ¨¡å¼
    "network_mode": "restricted",  // none/restricted/full

    // å…è®¸çš„åŸŸåç™½åå•
    "allowed_domains": []string{
        "api.github.com",
        "registry.npmjs.org",
    },

    // ç¦æ­¢çš„åŸŸåé»‘åå•
    "blocked_domains": []string{
        "*.internal.com",
    },

    // ä»£ç†é…ç½®
    "http_proxy": "http://proxy.example.com:8080",
}
```

### æŒä¹…åŒ–å­˜å‚¨

```go
Config: map[string]interface{}{
    // æŒ‚è½½å·
    "volumes": []map[string]string{
        {
            "source": "/host/data",
            "target": "/workspace/data",
            "readonly": false,
        },
    },

    // çŠ¶æ€æŒä¹…åŒ–
    "persistent_volume": "/mnt/agent-state",
    "restore_on_start": true,
}
```

### é•œåƒé…ç½®

```go
Config: map[string]interface{}{
    // è‡ªå®šä¹‰é•œåƒ
    "image": "my-registry.com/agent-runtime:v1.0",

    // é•œåƒæ‹‰å–ç­–ç•¥
    "image_pull_policy": "IfNotPresent",  // Always/IfNotPresent/Never

    // é•œåƒå‡­æ®
    "image_pull_secrets": []string{"my-registry-secret"},
}
```

## ğŸ”’ å®‰å…¨ç­–ç•¥

### æ–‡ä»¶ç³»ç»Ÿéš”ç¦»

```go
Config: map[string]interface{}{
    // åªè¯»æŒ‚è½½
    "readonly_paths": []string{
        "/etc",
        "/usr",
    },

    // ç¦æ­¢è®¿é—®
    "blocked_paths": []string{
        "/proc",
        "/sys",
    },

    // ä¸´æ—¶ç›®å½•
    "temp_dir": "/tmp/agent",
    "auto_clean_temp": true,
}
```

### å‘½ä»¤ç™½åå•

```go
Config: map[string]interface{}{
    // å…è®¸çš„å‘½ä»¤
    "allowed_commands": []string{
        "ls", "cat", "echo",
        "go", "python3", "node",
        "git", "npm", "pip",
    },

    // ç¦æ­¢çš„å‘½ä»¤
    "blocked_commands": []string{
        "rm", "dd", "mkfs",
        "sudo", "su",
    },
}
```

### ç¯å¢ƒå˜é‡è¿‡æ»¤

```go
Config: map[string]interface{}{
    // å…è®¸ä¼ é€’çš„ç¯å¢ƒå˜é‡
    "env_whitelist": []string{
        "PATH",
        "HOME",
        "LANG",
    },

    // ç¦æ­¢çš„ç¯å¢ƒå˜é‡
    "env_blacklist": []string{
        "AWS_*",
        "GITHUB_TOKEN",
    },
}
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ‰§è¡Œæ—¥å¿—

```go
// è®¢é˜…Monitoré€šé“è·å–æ²™ç®±äº‹ä»¶
monitorCh := ag.Subscribe([]types.AgentChannel{
    types.ChannelMonitor,
}, nil)

for envelope := range monitorCh {
    if e, ok := envelope.Event.(*types.MonitorSandboxExecutionEvent); ok {
        log.Printf("æ²™ç®±æ‰§è¡Œ: Command=%s Duration=%v ExitCode=%d",
            e.Command, e.Duration, e.ExitCode)
    }
}
```

### èµ„æºç›‘æ§

```go
type MonitorSandboxResourceEvent struct {
    CPUUsage    float64  // CPUä½¿ç”¨ç‡
    MemoryUsage int64    // å†…å­˜ä½¿ç”¨ï¼ˆå­—èŠ‚ï¼‰
    DiskUsage   int64    // ç£ç›˜ä½¿ç”¨ï¼ˆå­—èŠ‚ï¼‰
    NetworkIn   int64    // ç½‘ç»œå…¥ï¼ˆå­—èŠ‚ï¼‰
    NetworkOut  int64    // ç½‘ç»œå‡ºï¼ˆå­—èŠ‚ï¼‰
}
```

### å‘Šè­¦é…ç½®

```go
Config: map[string]interface{}{
    // èµ„æºå‘Šè­¦é˜ˆå€¼
    "alert_cpu_threshold": 80.0,     // CPUä½¿ç”¨ç‡è¶…è¿‡80%
    "alert_memory_threshold": 90.0,   // å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡90%
    "alert_disk_threshold": 95.0,     // ç£ç›˜ä½¿ç”¨ç‡è¶…è¿‡95%

    // å‘Šè­¦å›è°ƒ
    "alert_webhook": "https://alerts.example.com/webhook",
}
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. é€‰æ‹©åˆé€‚çš„æ²™ç®±

```go
// å¼€å‘ç¯å¢ƒ
if os.Getenv("ENV") == "development" {
    sandboxKind = types.SandboxKindLocal
}

// æµ‹è¯•ç¯å¢ƒ
if os.Getenv("ENV") == "test" {
    sandboxKind = types.SandboxKindMock
}

// ç”Ÿäº§ç¯å¢ƒ
if os.Getenv("ENV") == "production" {
    sandboxKind = types.SandboxKindAliyun
}
```

### 2. è®¾ç½®åˆç†çš„è¶…æ—¶

```go
Config: map[string]interface{}{
    // çŸ­ä»»åŠ¡
    "timeout": 30,  // 30ç§’

    // é•¿ä»»åŠ¡ï¼ˆç¼–è¯‘ã€æµ‹è¯•ï¼‰
    "timeout": 600,  // 10åˆ†é’Ÿ

    // æ‰¹é‡å¤„ç†
    "timeout": 3600,  // 1å°æ—¶
}
```

### 3. æ¸…ç†ä¸´æ—¶æ–‡ä»¶

```go
Config: map[string]interface{}{
    "auto_clean": true,
    "clean_on_stop": true,
    "max_disk_usage": 5 * 1024 * 1024 * 1024,  // 5GB
}
```

### 4. é”™è¯¯å¤„ç†

```go
result, err := sandbox.Execute(ctx, cmd)
if err != nil {
    // æ£€æŸ¥é”™è¯¯ç±»å‹
    if errors.Is(err, context.DeadlineExceeded) {
        log.Println("å‘½ä»¤è¶…æ—¶")
    } else if errors.Is(err, sandbox.ErrResourceLimit) {
        log.Println("èµ„æºé™åˆ¶")
    } else {
        log.Printf("æ‰§è¡Œå¤±è´¥: %v", err)
    }
    return err
}

// æ£€æŸ¥é€€å‡ºç 
if result.ExitCode != 0 {
    log.Printf("å‘½ä»¤å¤±è´¥: %s", result.Stderr)
}
```

### 5. æ€§èƒ½ä¼˜åŒ–

```go
// å¤ç”¨æ²™ç®±å®ä¾‹
type SandboxPool struct {
    pool chan sandbox.Sandbox
}

func (p *SandboxPool) Get() sandbox.Sandbox {
    select {
    case sb := <-p.pool:
        return sb
    default:
        return sandbox.New()
    }
}

func (p *SandboxPool) Put(sb sandbox.Sandbox) {
    select {
    case p.pool <- sb:
    default:
        sb.Stop(context.Background())
    }
}
```

## ğŸ“š ä¸‹ä¸€æ­¥

- [Agentç”Ÿå‘½å‘¨æœŸ](/core-concepts/agent-lifecycle) - ç†è§£æ²™ç®±åœ¨Agentç”Ÿå‘½å‘¨æœŸä¸­çš„ä½œç”¨
- [å·¥å…·ç³»ç»Ÿ](/core-concepts/tools-system) - ç†è§£å·¥å…·å¦‚ä½•ä½¿ç”¨æ²™ç®±
- [å®æˆ˜æŒ‡å—](/guides/sandbox-setup) - æ²™ç®±é…ç½®å’Œä½¿ç”¨ç¤ºä¾‹
- [APIå‚è€ƒ](/api-reference/sandbox-api) - è¯¦ç»†çš„Sandbox APIæ–‡æ¡£

## ğŸ”— ç›¸å…³èµ„æº

- [é˜¿é‡Œäº‘AgentBayæ–‡æ¡£](https://help.aliyun.com/product/agentbay.html)
- [ç«å±±å¼•æ“æ²™ç®±æ–‡æ¡£](https://www.volcengine.com/docs/sandbox)
- [æ²™ç®±ç¤ºä¾‹ä»£ç ](https://github.com/wordflowlab/agentsdk/tree/main/examples/sandbox)
